
<!-- 个人中心 -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>个人中心</title>
		<link rel="stylesheet" href="../../layui/css/layui.css">
		<!-- 样式 -->
		<link rel="stylesheet" href="../../css/style.css" />
		<!-- 主题（主要颜色设置） -->
		<link rel="stylesheet" href="../../css/theme.css" />
		<!-- 通用的css -->
		<link rel="stylesheet" href="../../css/common.css" />
	</head>
	<style>
		/* 基础布局 */
		html::after {
			position: fixed;
			top: 0;
			right: 0;
			left: 0;
			bottom: 0;
			content: '';
			display: block;
			background-attachment: fixed;
			background-size: cover;
			background-position: center;
			z-index: -1;
		}

		/* 轮播图优化 */
		#swiper {
			border-radius: 0 0 20px 20px;
			overflow: hidden;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
		}

		#swiper .layui-carousel-ind li {
			width: 50px;
			height: 4px;
			border: none;
			border-radius: 2px;
			background: rgba(255, 255, 255, 0.5);
			box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
			transition: all 0.3s ease;
		}

		#swiper .layui-carousel-ind li.layui-this {
			width: 70px;
			background: #fff;
			box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
		}

		/* 标题样式 */
		.index-title {
			padding: 30px 0;
			background: linear-gradient(45deg, #2c3e50, #34495e);
			border-radius: 10px;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
			margin: 20px auto;
		}

		.index-title span {
			color: #fff;
			font-size: 32px;
			font-weight: 600;
			text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
			letter-spacing: 2px;
		}

		/* 中心容器 */
		.center-container {
			display: flex;
			flex-wrap: wrap; /* 支持自适应 */
			max-width: 1400px;
			margin: 30px auto;
			background: #fff;
			border-radius: 15px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
			overflow: hidden;
		}

		/* 左侧菜单 */
		.left-container {
			width: 250px;
			background: linear-gradient(180deg, #2c3e50, #34495e);
			padding: 20px 0;
		}

		.left-container .layui-nav {
			background: transparent;
		}

		.left-container .layui-nav-item {
			margin: 5px 15px;
			border-radius: 8px;
			transition: all 0.3s ease;
		}

		.left-container .layui-nav-item a {
			padding: 0 20px;
			font-size: 16px;
			color: rgba(255, 255, 255, 0.8);
			height: 50px;
			line-height: 50px;
		}

		.left-container .layui-nav-item:hover,
		.left-container .layui-nav-item.layui-this {
			background: rgba(255, 255, 255, 0.1);
		}

		.left-container .layui-nav-item.layui-this a {
			color: #fff;
		}

		/* 右侧内容区 */
		.right-container {
			flex: 1;
			padding: 40px;
			background: #f8fafc;
		}

		/* 表单样式 */
		.layui-form-item {
			margin-bottom: 25px;
			background: #fff;
			padding: 20px;
			border-radius: 10px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
			transition: all 0.3s ease;
		}

		.layui-form-item:hover {
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
		}

		.layui-form-label {
			width: 120px;
			font-size: 15px;
			color: #2c3e50;
			font-weight: 500;
		}

		.layui-input-block {
			margin-left: 150px;
		}

		.layui-input,
		.layui-select {
			height: 45px;
			line-height: 45px;
			border: 1px solid #e0e6ed;
			border-radius: 8px;
			padding: 0 15px;
			transition: all 0.3s ease;
		}

		.layui-input:focus,
		.layui-select:focus {
			border-color: #3498db;
			box-shadow: 0 0 10px rgba(52, 152, 219, 0.1);
		}

		/* 头像上传 */
		#touxiangImg {
			width: 100px;
			height: 100px;
			border-radius: 50%;
			border: 3px solid #fff;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
			transition: all 0.3s ease;
		}

		#touxiangImg:hover {
			transform: scale(1.05);
		}

		/* 按钮样式 */
		.btn-theme {
			background: linear-gradient(45deg, #3498db, #2980b9);
			border: none;
			color: #fff;
			padding: 12px 30px;
			border-radius: 8px;
			font-size: 15px;
			font-weight: 500;
			box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
			transition: all 0.3s ease;
		}

		.btn-theme:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
		}

		.btn-submit {
			margin: 20px 10px;
			min-width: 150px;
		}

		/* 响应式设计 */
		@media screen and (max-width: 992px) {
			.center-container {
				flex-direction: column;
			}

			.left-container {
				width: 100%;
				padding: 10px;
			}

			.right-container {
				padding: 20px;
			}

			.layui-input-block {
				margin-left: 0;
			}

			.layui-form-label {
				width: 100%;
				text-align: left;
				padding: 10px 0;
			}

			/* 轮播图优化 */
			#swiper .layui-carousel-ind li {
				width: 40px;
				height: 4px;
			}
		}
	</style>

	<body>
	<div id="app">
		<!-- 轮播图部分 -->
		<div class="banner-section">
			<div class="layui-carousel" id="swiper">
				<div carousel-item>
					<div v-for="(item, index) in swiperList" :key="index">
						<img style="width: 100%; height: 100%; object-fit: cover;" :src="item.img" />
					</div>
				</div>
			</div>
		</div>

		<!-- 标题部分 -->
		<div class="index-title">
			<div class="title-content">
				<span class="title-text">CZJTU</span>
				<span class="title-text">个人中心</span>
			</div>
		</div>

		<!-- 主体内容区 -->
		<div class="center-container">
			<!-- 左侧菜单 -->
			<div class="left-container">
				<ul class="layui-nav layui-nav-tree">
					<li v-for="(item, index) in centerMenu"
						:key="index"
						class="layui-nav-item"
						:class="index == 0 ? 'layui-this' : ''">
						<a :href="'javascript:jump(\''+item.url+'\')'">{{item.name}}</a>
					</li>
				</ul>
			</div>

			<!-- 右侧表单区域 -->
			<div class="right-container">
				<form class="layui-form" lay-filter="myForm">
					<input type="hidden" name="id" id="id" />

					<!-- 表单项 -->
					<div class="form-section">
						<!-- 账号信息 -->
						<div class="form-group">
							<div class="layui-form-item">
								<label class="layui-form-label">学生账号</label>
								<div class="layui-input-block">
									<input type="text" name="xueshengzhanghao" id="xueshengzhanghao"
										   placeholder="学生账号" autocomplete="off" class="layui-input">
								</div>
							</div>

							<div class="layui-form-item">
								<label class="layui-form-label">密码</label>
								<div class="layui-input-block">
									<input type="password" name="mima" id="mima"
										   placeholder="密码" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>

						<!-- 个人信息 -->
						<div class="form-group">
							<div class="layui-form-item">
								<label class="layui-form-label">学生姓名</label>
								<div class="layui-input-block">
									<input type="text" name="xueshengxingming" id="xueshengxingming"
										   placeholder="学生姓名" autocomplete="off" class="layui-input">
								</div>
							</div>

							<div class="layui-form-item">
								<label class="layui-form-label">性别</label>
								<div class="layui-input-block">
									<select name="xingbie" id="xingbie">
										<option value="">请选择</option>
										<option v-for="(item, index) in xingbie"
												:key="index" :value="item">{{item}}</option>
									</select>
								</div>
							</div>

							<div class="layui-form-item">
								<label class="layui-form-label">手机号码</label>
								<div class="layui-input-block">
									<input type="text" name="shoujihaoma" id="shoujihaoma"
										   placeholder="手机号码" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>

						<!-- 头像上传 -->
						<div class="form-group">
							<div class="layui-form-item avatar-section">
								<label class="layui-form-label">头像</label>
								<div class="layui-input-block">
									<div class="avatar-container">
										<img id="touxiangImg" src="../../img/avator.png">
										<input type="hidden" id="touxiang" name="touxiang" />
									</div>
									<button type="button" class="layui-btn btn-upload" id="touxiangUpload">
										<i class="layui-icon">&#xe67c;</i>上传图片
									</button>
								</div>
							</div>
						</div>
					</div>

					<!-- 按钮组 -->
					<div class="form-actions">
						<button class="layui-btn btn-submit btn-theme" lay-submit lay-filter="*">
							更新信息
						</button>
						<button class="layui-btn btn-submit btn-logout" @click="logout">
							退出登录
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	</body>

		<!-- layui -->
		<script src="../../layui/layui.js"></script>
		<!-- vue -->
		<script src="../../js/vue.js"></script>
		<!-- 组件配置信息 -->
		<script src="../../js/config.js"></script>
		<!-- 扩展插件配置信息 -->
		<script src="../../modules/config.js"></script>
		<!-- 工具方法 -->
		<script src="../../js/utils.js"></script>
		<!-- 校验格式工具类 -->
		<script src="../../js/validate.js"></script>


	<script>
		var vue = new Vue({
			el: '#app',
			data: {
				// 轮播图
				swiperList: [],
				xingbie: [],
				centerMenu: centerMenu
			},
			updated: function() {
				layui.form.render(null, 'myForm');
			},
			methods: {
				jump(url) {
					jump(url)
				},
				logout(){
					localStorage.removeItem('Token');
					localStorage.removeItem('role');
					localStorage.removeItem('sessionTable');
					localStorage.removeItem('adminName');
					localStorage.removeItem('userid');
					localStorage.removeItem('userTable');
					localStorage.removeItem('iframeUrl');
					window.parent.location.href = '../login/login.html';
				}
			}
		})

		layui.use(['layer', 'element', 'carousel', 'http', 'jquery', 'form', 'upload'], function() {
			var layer = layui.layer;
			var element = layui.element;
			var carousel = layui.carousel;
			var http = layui.http;
			var jquery = layui.jquery;
			var form = layui.form;
			var upload = layui.upload;

			// 获取轮播图 数据
			http.request('config/list', 'get', {
				page: 1,
				limit: 5
			}, function(res) {
				if (res.data.list.length > 0) {
					let swiperList = [];
					res.data.list.forEach(element => {
						if (element.value != null) {
							swiperList.push({
								img: element.value
							});
						}
					});
					vue.swiperList = swiperList;
					vue.$nextTick(() => {
						carousel.render({
							elem: '#test1',
							width: '100%',
							height: '500px',
							arrow: 'always',
							anim: 'fade',
							autoplay: 'true',
							interval: '3000',
							indicator: 'inside'
						});
					})
					// vue.$nextTick(()=>{
					//   window.xznSlide();
					// });
				}
			});

			// 获取轮播图 数据
			http.request('config/list', 'get', {
				page: 1,
				limit: 5
			}, function(res) {
				if (res.data.list.length > 0) {
					var swiperItemHtml = '';
					for (let item of res.data.list) {
						if (item.name.indexOf('picture') >= 0 && item.value && item.value != "" && item.value != null) {
							swiperItemHtml +=
									'<div>' +
									'<img style="width: 100%;height: 100%;object-fit:cover;" class="swiper-item" src="' + item.value + '">' +
									'</div>';
						}
					}
					jquery('#swiper-item').html(swiperItemHtml);
					// 轮播图
					vue.$nextTick(() => {
						carousel.render({
							elem: '#swiper',
							width: '100%',
							height: '500px',
							arrow: 'always',
							anim: 'fade',
							autoplay: 'true',
							interval: '3000',
							indicator: 'inside'
						});

					})
					// carousel.render({
					// 	elem: '#swiper',
					// 	width: swiper.width,height:swiper.height,
					// 	arrow: swiper.arrow,
					// 	anim: swiper.anim,
					// 	interval: swiper.interval,
					// 	indicator: "none"
					// });
				}
			});







			vue.xingbie = '男,女'.split(',')
			// 上传图片
			var touxiangUpload = upload.render({
				//绑定元素
				elem: '#touxiangUpload',
				//上传接口
				url: http.baseurl + 'file/upload',
				// 请求头
				headers: {
					Token: localStorage.getItem('Token')
				},
				// 允许上传时校验的文件类型
				accept: 'images',
				before: function() {
					//loading层
					var index = layer.load(1, {
						shade: [0.1, '#fff'] //0.1透明度的白色背景
					});
				},
				// 上传成功
				done: function(res) {
					console.log(res);
					layer.closeAll();
					if (res.code == 0) {
						layer.msg("上传成功", {
							time: 2000,
							icon: 6
						})
						var url = http.baseurl + 'upload/' + res.file;
						jquery('#touxiang').val(url);
						jquery('#touxiangImg').attr('src', url)
					} else {
						layer.msg(res.msg, {
							time: 2000,
							icon: 5
						})
					}
				},
				//请求异常回调
				error: function() {
					layer.closeAll();
					layer.msg("请求接口异常", {
						time: 2000,
						icon: 5
					})
				}
			});

			// 查询用户信息
			let table = localStorage.getItem("userTable");

			if(!table){
				layer.msg('请先登录', {
					time: 2000,
					icon: 5
				}, function() {
					window.parent.location.href = '../login/login.html';
				});
			}


			http.request(`${table}/session`, 'get', {}, function(data) {
				// 表单赋值
				form.val("myForm", data.data);
				// 图片赋值
				jquery("#touxiangImg").attr("src", data.data.touxiang);
			});

			// 提交表单
			form.on('submit(*)', function(data) {
				data = data.field;
				if(!data.xueshengzhanghao){
					layer.msg('学生账号不能为空', {
						time: 2000,
						icon: 5
					});
					return false
				}
				if(!data.mima){
					layer.msg('密码不能为空', {
						time: 2000,
						icon: 5
					});
					return false
				}
				if(!isMobile(data.shoujihaoma)){
					layer.msg('手机号码应输入手机格式', {
						time: 2000,
						icon: 5
					});
					return false
				}
				http.requestJson(table + '/update', 'post', data, function(res) {
					layer.msg('修改成功', {
						time: 2000,
						icon: 6
					}, function() {
						window.location.reload();
					});
				});
				return false
			});

		});
	</script>
	</body>
</html>
